"use strict";(self.webpackChunk_yozora_doc=self.webpackChunk_yozora_doc||[]).push([[2750],{6763:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>h,contentTitle:()=>c,default:()=>x,frontMatter:()=>l,metadata:()=>a,toc:()=>d});var s=i(4848),t=i(8453),o=i(9489),r=i(7227);const l={id:"core-tokenizer",title:"@yozora/core-tokenizer",sidebar_label:"core-tokenizer"},c=void 0,a={id:"package/core-tokenizer",title:"@yozora/core-tokenizer",description:"<img",source:"@site/versioned_docs/version-1.x.x/package/core-tokenizer.mdx",sourceDirName:"package",slug:"/package/core-tokenizer",permalink:"/docs/1.x.x/package/core-tokenizer",draft:!1,unlisted:!1,tags:[],version:"1.x.x",lastUpdatedBy:"guanghechen",lastUpdatedAt:1710076334,formattedLastUpdatedAt:"Mar 10, 2024",frontMatter:{id:"core-tokenizer",title:"@yozora/core-tokenizer",sidebar_label:"core-tokenizer"},sidebar:"API",previous:{title:"ast-util",permalink:"/docs/1.x.x/package/ast-util"},next:{title:"core-parser",permalink:"/docs/1.x.x/package/core-parser"}},h={},d=[{value:"Install",id:"install",level:2},{value:"Usage",id:"usage",level:2},{value:"Block Tokenizer",id:"block-tokenizer",level:3},{value:"match-block phase",id:"match-block-phase",level:4},{value:"post-match-block phase",id:"post-match-block-phase",level:4},{value:"parse-block phase",id:"parse-block-phase",level:4},{value:"Inline Tokenizer",id:"inline-tokenizer",level:3},{value:"match-inline phase",id:"match-inline-phase",level:4},{value:"parser-inline phase",id:"parser-inline-phase",level:4},{value:"Related",id:"related",level:2}];function p(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",h4:"h4",hr:"hr",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("header",{children:(0,s.jsxs)("div",{align:"center",children:[(0,s.jsx)("a",{href:"https://www.npmjs.com/package/@yozora/core-tokenizer",children:(0,s.jsx)("img",{alt:"Npm Version",src:"https://img.shields.io/npm/v/@yozora/core-tokenizer/v1.x.x"})}),(0,s.jsx)("a",{href:"https://www.npmjs.com/package/@yozora/core-tokenizer",children:(0,s.jsx)("img",{alt:"Npm Download",src:"https://img.shields.io/npm/dm/@yozora/core-tokenizer.svg"})}),(0,s.jsx)("a",{href:"https://www.npmjs.com/package/@yozora/core-tokenizer",children:(0,s.jsx)("img",{alt:"Npm License",src:"https://img.shields.io/npm/l/@yozora/core-tokenizer.svg"})}),(0,s.jsx)("a",{href:"#install",children:(0,s.jsx)("img",{alt:"Module formats: cjs, esm",src:"https://img.shields.io/badge/module_formats-cjs%2C%20esm-green.svg"})}),(0,s.jsx)("a",{href:"https://github.com/nodejs/node",children:(0,s.jsx)("img",{alt:"Node.js Version",src:"https://img.shields.io/node/v/@yozora/core-tokenizer"})}),(0,s.jsx)("a",{href:"https://github.com/prettier/prettier",children:(0,s.jsx)("img",{alt:"Code Style: prettier",src:"https://img.shields.io/badge/code_style-prettier-ff69b4.svg?style=flat-square"})})]})}),"\n",(0,s.jsx)("br",{}),"\n",(0,s.jsx)(n.p,{children:"Defines the shape of Yozora Tokenizer and life cycle methods, as well as some\nutility functions to assist in resolving tokens."}),"\n",(0,s.jsx)(n.h2,{id:"install",children:"Install"}),"\n",(0,s.jsxs)(o.A,{groupId:"npm2yarn",children:[(0,s.jsx)(r.A,{value:"npm",children:(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"npm install --save @yozora/core-tokenizer\n"})})}),(0,s.jsx)(r.A,{value:"yarn",label:"Yarn",children:(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"yarn add @yozora/core-tokenizer\n"})})}),(0,s.jsx)(r.A,{value:"pnpm",label:"pnpm",children:(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"pnpm add @yozora/core-tokenizer\n"})})})]}),"\n",(0,s.jsx)(n.h2,{id:"usage",children:"Usage"}),"\n",(0,s.jsx)(n.p,{children:"According to the Parse Strategy, there are two types of tokenizers: Block\nTokenizer and Inline tokenizer."}),"\n",(0,s.jsx)(n.h3,{id:"block-tokenizer",children:"Block Tokenizer"}),"\n",(0,s.jsx)(n.p,{children:"The parsing steps of the block tokenizer are divided into three life cycles:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"match-block"}),": match a block node and get a ",(0,s.jsx)(n.code,{children:"BlockToken"})]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"post-match-block"}),": filter or merge block-level nodes at the same level\n(currently only used in ",(0,s.jsx)(n.a,{href:"./tokenizer-list",children:"@yozora/tokenizer-list"}),")"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"parse-block"}),": Parse a ",(0,s.jsx)(n.code,{children:"BlockToken"})," into a YAST node"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"match-block-phase",children:"match-block phase"}),"\n",(0,s.jsx)(n.p,{children:"In the process of parsing block nodes, the content is read line by line. The\nblock-level node has a nested structure:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-markdown",metastring:"{2}",children:"> This is a blockquote\n> - This is a list item in blockquote\n> - # This is a setext heading in the list item of the blockquote\n> - > ...\n"})}),"\n",(0,s.jsxs)(n.p,{children:["As shown in the second line of the above code, when parsing\n",(0,s.jsx)(n.a,{href:"./tokenizer-list-item",children:"ListItem"}),", it cannot get the first character in\nthe original document line, but wait for its ancestor elements along the\nexisting nesting structure (such as the above ",(0,s.jsx)(n.a,{href:"./tokenizer-list-item",children:"Blockquote"}),")\nto complete the matching, and then gets a matching opportunity. In order to make\nthe tokenizers work with each other transparently, when designing the life cycle\nmethods of the block-level tokenizer in the ",(0,s.jsx)(n.code,{children:"match-block"})," stage, the parsing\nlogic of the nested structure lifted into ",(0,s.jsx)(n.a,{href:"./core-parser",children:"@yozora/core-parser "}),", and use a\nspecial data structure called ",(0,s.jsx)(n.code,{children:"PhrasingContentLine"})," as the actual parsing unit\nof a line:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"export interface PhrasingContentLine {\n  /**\n   * Start index of interval in nodePoints.\n   */\n  startIndex: number\n  /**\n   * End index of interval in nodePoints.\n   */\n  endIndex: number\n  /**\n   * Array of NodePoint which contains all the contents of this line.\n   */\n  nodePoints: ReadonlyArray<NodePoint>\n  /**\n   * The index of first non-blank character in the rest of the current line\n   */\n  firstNonWhitespaceIndex: number\n  /**\n   * The precede space count, one tab equals four space.\n   * @see https://github.github.com/gfm/#tabs\n   */\n  countOfPrecedeSpaces: number\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["The life cycle methods at this stage is subdivided into the following methods\n(see ",(0,s.jsx)(n.a,{href:"https://github.com/yozorajs/yozora/blob/main/packages/core-tokenizer/src/types/lifecycle/match-block.ts",children:"match-block"})," for the type definition details):"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"eatOpener"}),": (Required) Try to match a new block node."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"eatAndInterruptPreviousSibling"}),": (optional) try to interrupt the previous\nsibling node and match a new block node."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"eatContinuationText"}),": (Optional) Try to match the continuation text of current\nblock node, that is, consume the current ",(0,s.jsx)(n.code,{children:"PhrasingContentLine"})," with the current\nblock node. There may be many kinds of results at this stage, which are\ndistinguished according to the value of ",(0,s.jsx)(n.code,{children:"status"})," in the returned result:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"notMatched"}),": Not matched."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"closing"}),": Matched and this is the last line of the current block node.\nThat is, the current block node is in a saturated state and is closing."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"opening"}),": Matched, and not closing yet."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"failedAndRollback"}),": The match fails, and the content of the previous lines\nare to be rolled back. For convenience, it is assumed that the rollback\noperation does not affect the previously satisfied nested structure."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"closingAndRollback"}),": Matching failed, but only the last line needs to be\nrollback, the current node is still a valid one and will be closed soon."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"eatLazyContinuationText"}),": (Optional) Try to match Laziness Continuation Text.\nActually only the ",(0,s.jsx)(n.a,{href:"./tokenizer-paragraph",children:"@yozora/tokenizer-paragraph"})," needs to implement this\nmethod, see ",(0,s.jsx)(n.a,{href:"https://github.github.com/gfm/#phase-1-block-structure",children:"https://github.github.com/gfm/#phase-1-block-structure"})," step3\nfor details."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"onClose"}),": (Optional) Called when the current node is closed, used to perform"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"some cleanup operations."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"extractPhrasingContentLines"}),": (Optional) Convert a Block Token generated by\nthe current tokenizer to ",(0,s.jsx)(n.code,{children:"PhrasingContentLines[]"}),". This method is only needed\nwhen the matching node of this type may be rolled back."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"buildBlockToken"}),": (Optional) Convert ",(0,s.jsx)(n.code,{children:"PhrasingContentLines[]"})," into a Block Token.\nThis method is only needed when the matching node of this type may be rolled back"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"post-match-block-phase",children:"post-match-block phase"}),"\n",(0,s.jsxs)(n.p,{children:["The lifecycle methods at this stage are subdivided into the following methods\n(for complete type definitions, see ",(0,s.jsx)(n.a,{href:"https://github.com/yozorajs/yozora/blob/main/packages/core-tokenizer/src/types/lifecycle/post-match-block.ts",children:"post-match-block"}),"):"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"transformMatch"}),": (Required) Convert the sibling nodes of a certain level in\nthe tree obtained in the ",(0,s.jsx)(n.a,{href:"https://github.com/yozorajs/yozora/blob/main/packages/core-tokenizer/src/types/lifecycle/match-block.ts",children:"match-block"})," stage into a new\nblock node list. In fact, this life cycle method is only implemented in\n",(0,s.jsx)(n.a,{href:"./tokenizer-list",children:"@yozora/tokenizer-list"})]}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"parse-block-phase",children:"parse-block phase"}),"\n",(0,s.jsxs)(n.p,{children:["The life cycle methods at this stage is subdivided into the following methods\n(see ",(0,s.jsx)(n.a,{href:"https://github.com/yozorajs/yozora/blob/main/packages/core-tokenizer/src/types/lifecycle/parse-block.ts",children:"parse-block"})," for the complete type definition):"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"parseBlock"}),": Convert a Block Token into Yast Node"]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h3,{id:"inline-tokenizer",children:"Inline Tokenizer"}),"\n",(0,s.jsx)(n.p,{children:"The parsing step of the inline parser is divided into two life cycles"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"match-inline"}),": Match the inline contents and get an ",(0,s.jsx)(n.code,{children:"InlineToken"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"parse-inline"}),": Parse an ",(0,s.jsx)(n.code,{children:"InlineToken"})," into a YAST node"]}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"match-inline-phase",children:"match-inline phase"}),"\n",(0,s.jsxs)(n.p,{children:['After a block node is closed, we can start matching inline nodes, so when we\nmatch inline nodes, we get a continuous text without the concept of "line".\nBut inline nodes have priority. For example, link has a higher priority than\nemphasis (see ',(0,s.jsx)(n.a,{href:"https://github.github.com/gfm/#example-529",children:"https://github.github.com/gfm/#example-529"}),"). In order to enable\nunperceptual coordination between tokenizers, when designing the life cycle\nfunction of the inline tokenizer in the ",(0,s.jsx)(n.code,{children:"match-inline"})," phase, put priority-related\nlogic in ",(0,s.jsx)(n.a,{href:"./core-parser",children:"@yozora/core-parser"})," In processing, each tokenizer only provides\nfour types of separators: ",(0,s.jsx)(n.code,{children:"opener"}),", ",(0,s.jsx)(n.code,{children:"both"}),", ",(0,s.jsx)(n.code,{children:"closer"}),", ",(0,s.jsx)(n.code,{children:"full"}),". Then the\nprocessor in ",(0,s.jsx)(n.a,{href:"./core-parser",children:"@yozora/core-parser"})," completes the coordination work."]}),"\n",(0,s.jsxs)(n.p,{children:["The lifecycle methods at this stage is subdivided into the following methods\n(see ",(0,s.jsx)(n.a,{href:"https://github.com/yozorajs/yozora/blob/main/packages/core-tokenizer/src/types/lifecycle/match-inline.ts",children:"match-inline"})," for the complete type definition):"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"findDelimiter"}),": (Required) Find a delimiter"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"isDelimiterPair"}),": (Optional) Check whether the given two delimiters can match"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"processDelimiterPair"}),": (Optional) Process the matched two delimiters. Such as ",(0,s.jsx)(n.a,{href:"./tokenizer-emphasis",children:"@yozora/tokenizer-emphasis"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"processSingleDelimiter"}),":  (Optional) Process a single delimiter. Such as ",(0,s.jsx)(n.a,{href:"./tokenizer-text",children:"@yozora/tokenizer-text"})]}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"parser-inline-phase",children:"parser-inline phase"}),"\n",(0,s.jsx)(n.p,{children:"The lifecycle methods at this stage is subdivided into the following methods\n(see [parse-inline][lifecycle-pase-inline] for the complete type definition):"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"processToken"}),": (Required) Convert an Inline Token to a YAST node."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"related",children:"Related"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://github.com/yozorajs/yozora/tree/release-1.x.x/packages/core-tokenizer",children:"Sourcecode"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.a,{href:"https://github.com/yozorajs/yozora/tree/release-1.x.x/packages/template-tokenizer#readme",children:"@yozora/template-tokenizer"})," For creating a Yozora Tokenizer."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Block Tokenizer Lifecycle"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/yozorajs/yozora/blob/main/packages/core-tokenizer/src/types/lifecycle/match-block.ts",children:"match-block"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/yozorajs/yozora/blob/main/packages/core-tokenizer/src/types/lifecycle/post-match-block.ts",children:"post-match-block"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/yozorajs/yozora/blob/main/packages/core-tokenizer/src/types/lifecycle/parse-block.ts",children:"parse-block"})}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Inline Tokenizer Lifecycle"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/yozorajs/yozora/blob/main/packages/core-tokenizer/src/types/lifecycle/match-inline.ts",children:"match-inline"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/yozorajs/yozora/blob/main/packages/core-tokenizer/src/types/lifecycle/parse-inline.ts",children:"parse-inline"})}),"\n"]}),"\n"]}),"\n"]})]})}function x(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(p,{...e})}):p(e)}}}]);